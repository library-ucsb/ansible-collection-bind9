include "/etc/rndc.key";
controls {
        inet 127.0.0.1 port 953	 allow {127.0.0.1; } keys { rndckey; };
};


// Zone Transfers
acl "xfer" { 128.111.87.44; 128.111.1.1; 128.111.1.2; };

acl "d42" { 128.111.87.26; };

acl "campus-ns" { 128.111.1.1; 128.111.1.2; };

acl "library-slaves-int" { 10.3.3.44; 10.11.2.44; };

acl "library-slaves-ext" { 10.3.3.45; };

// Wireless Clients (our BlueSocket, not campus wireless)
acl "wireless" { 128.111.96.78; };

acl "management" { !10.3.3.44; !10.11.2.44; !10.3.3.45; 10.0.0.0/8; 192.168.2.0/24; };

// Hosts inside the library networks 
acl "internal" { 128.111.87.0/24; 128.111.95.0/24; 128.111.96.0/24; 128.111.97.0/24; 10.0.0.0/8; 192.168.2.0/24; };

// "bogon" networks
acl "bogon" {
    // Filter out the bogon networks.  These are networks
    // listed by IANA as test, RFC1918, Multicast, experi-
    // mental, etc.  If you see DNS queries or updates with
    // a source address within these networks, this is likely
    // of malicious origin. CAUTION: If you are using RFC1918
    // netblocks on your network, remove those netblocks from
    // this list of blackhole ACLs!
    0.0.0.0/8;
    1.0.0.0/8;
    2.0.0.0/8;
    5.0.0.0/8;
    //10.0.0.0/8;
    14.0.0.0/8;
    23.0.0.0/8;
    27.0.0.0/8;
    31.0.0.0/8;
    36.0.0.0/8;
    37.0.0.0/8;
    39.0.0.0/8;
    42.0.0.0/8;
    46.0.0.0/8;
    49.0.0.0/8;
    50.0.0.0/8;
    100.0.0.0/8;
    101.0.0.0/8;
    102.0.0.0/8;
    103.0.0.0/8;
    104.0.0.0/8;
    105.0.0.0/8;
    106.0.0.0/8;
    107.0.0.0/8;
    109.0.0.0/8;
    169.254.0.0/16;
    172.16.0.0/12;
    175.0.0.0/8;
    176.0.0.0/8;
    177.0.0.0/8;
    178.0.0.0/8;
    179.0.0.0/8;
    180.0.0.0/8;
    181.0.0.0/8;
    182.0.0.0/8;
    183.0.0.0/8;
    185.0.0.0/8;
    192.0.2.0/24;
    //192.168.0.0/16;
    198.18.0.0/15;
    223.0.0.0/8;
    224.0.0.0/3;
}; 

// Logging

logging {

	channel default_syslog {
		// Send most of the named messages to syslog
		syslog local2;
		//severity debug 5;
		//severity info;
		severity warning;
	};

	channel audit_log {
		// Send the security related messages to a separate file.
		file "/var/log/named-audit.log";
		//severity debug 5;
		severity info;
		print-time yes;
	};

	channel transfer_log {
		file "/var/log/transfer.log";
		severity debug 5;
		print-time yes;
	};

	category default { default_syslog; };
	category general { default_syslog; };
	category security { audit_log; default_syslog; };
	category config { default_syslog; };
	category resolver { audit_log; };
	category xfer-in { audit_log; transfer_log; };
	category xfer-out { audit_log; transfer_log; };
	category notify { audit_log; };
	category client { audit_log; };
	category network { audit_log; };
	category update { audit_log; };
	category queries { audit_log; default_syslog; };
	category lame-servers { audit_log; };

};

// Global
options {
	directory "/var/named";
        pid-file "/var/named/run/named.pid";
        statistics-file "/var/named/named.stats";
	memstatistics-file "/var/named/named.memstats";
	dump-file "/var/named/named.dump";
	zone-statistics yes;
   	notify no;
   	transfer-format many-answers;
   	max-transfer-time-in 60;
   	interface-interval 0;
    	allow-transfer { none; };
    	allow-query { internal; wireless; management; };
    	allow-query-cache { internal; wireless; management; };
    	blackhole { bogon; }; 
	listen-on-v6 { none; };
};

view "internal" {
	//match-clients { 10.3.3.44; !10.3.3.45; internal; };
	match-clients {!128.111.87.44; internal; };
	recursion yes;
	additional-from-auth yes;
	additional-from-cache yes;

	zone "." in {
		type hint;
		file "/var/views/roothints/db.cache";
	};

	zone "0.0.127.in-addr.arpa" in {
   		type master;
    		file "/var/views/internal/0.0.127.in-addr.arpa.dns";

    		allow-query { any; };
    		allow-transfer { none; };
	}; 

	zone "10.in-addr.arpa" in {
		type master;
		file "/var/views/internal/10.in-addr.arpa.dns";

		allow-transfer { 10.11.2.44; };
		notify yes;
		notify-source 10.11.2.30;
		also-notify { 10.11.2.44; };
	};

	zone "2.168.192.in-addr.arpa" in {
		type master;
		file "/var/views/internal/2.168.192.in-addr.arpa.dns";

		allow-transfer { 10.11.2.44; };
		notify yes;
                notify-source 10.11.2.30;
		also-notify { 10.11.2.44; };
	};

	zone "87.111.128.in-addr.arpa" in {
		type master;
		file "/var/views/internal/87.111.128.in-addr.arpa.dns";

		allow-transfer { 10.11.2.44; };
		notify yes;
                notify-source 10.11.2.30;
		also-notify { 10.11.2.44; };
	};

	zone "95.111.128.in-addr.arpa" in {
		type master;
		file "/var/views/internal/95.111.128.in-addr.arpa.dns";

		allow-transfer { 10.11.2.44; };
		notify yes;
                notify-source 10.11.2.30;
		also-notify { 10.11.2.44; };
	};

	zone "96.111.128.in-addr.arpa" in {
		type master;
		file "/var/views/internal/96.111.128.in-addr.arpa.dns";

		allow-transfer { 10.11.2.44; };
		notify yes;
                notify-source 10.11.2.30;
		also-notify { 10.11.2.44; };
	};

	zone "97.111.128.in-addr.arpa" in {
		type master;
		file "/var/views/internal/97.111.128.in-addr.arpa.dns";

		allow-transfer { 10.11.2.44; };
		notify yes;
                notify-source 10.11.2.30;
		also-notify { 10.11.2.44; };
	};

	zone "alexandria.ucsb.edu" in {
		type master;
		file "/var/views/internal/alexandria.ucsb.edu.dns";

		allow-transfer { 10.11.2.44; };
		notify yes;
                notify-source 10.11.2.30;
		also-notify { 10.11.2.44; };
	};

	zone "library.ucsb.edu" in {
		type master;
		file "/var/views/internal/library.ucsb.edu.dns";

		allow-transfer { 10.11.2.44; };
		notify yes;
                notify-source 10.11.2.30;
		also-notify { 10.11.2.44; };
	};

	zone "sdc.ucsb.edu" in {
		type master;
		file "/var/views/internal/sdc.ucsb.edu.dns";

		allow-transfer { 10.11.2.44; };
		notify yes;
                notify-source 10.11.2.30;
		also-notify { 10.11.2.44; };
		
	};

	zone "ngda.info" in {
                type master;
                file "/var/views/internal/ngda.info.dns";

                allow-transfer { 10.11.2.44; };
		notify yes;
                notify-source 10.11.2.30;
		also-notify { 10.11.2.44; };
        };

        zone "ngda.net" in {
                type master;
                file "/var/views/internal/ngda.net.dns";

                allow-transfer { 10.11.2.44; };
		notify yes;
                notify-source 10.11.2.30;
		also-notify { 10.11.2.44; };
        };

        zone "ngda.org" in {
                type master;
                file "/var/views/internal/ngda.org.dns";

                allow-transfer { 10.11.2.44; };
		notify yes;
                notify-source 10.11.2.30;
		also-notify { 10.11.2.44; };
        };
};

view "external" {
        match-clients { !10.3.3.44; !10.11.2.44; any; };
        recursion no;
	additional-from-auth no;
	additional-from-cache no;

	zone "." in {
    		type hint;
    		file "/var/views/roothints/db.cache";
	};

	zone "alexandria.ucsb.edu" in {
		type master;
		file "/var/views/external/alexandria.ucsb.edu.dns";
		
		allow-query { any; };
		allow-transfer { 128.111.87.44; campus-ns; d42; };
		notify yes;
		also-notify { 128.111.87.44; };
                notify-source 128.111.87.30;
	};

	zone "library.ucsb.edu" in {
		type master;
		file "/var/views/external/library.ucsb.edu.dns";

		allow-query { any; };
		allow-transfer { 128.111.87.44; campus-ns; d42; };
		notify yes;
		also-notify { 128.111.87.44; };
		notify-source 128.111.87.30;
	};

	zone "sdc.ucsb.edu" in {
		type master;
		file "/var/views/external/sdc.ucsb.edu.dns";

		allow-query { any; };
		allow-transfer { 128.111.87.44; campus-ns; d42; };
		notify yes;
		also-notify { 128.111.87.44; };
		notify-source 128.111.87.30;
	};
       
	 zone "ngda.info" in {
                type master;
                file "/var/views/external/ngda.info.dns";

                allow-query { any; };
                allow-transfer { 128.111.87.44; campus-ns; d42; };
		notify yes;
		also-notify { 128.111.87.44; };
                notify-source 128.111.87.30;
        };

        zone "ngda.net" in {
                type master;
                file "/var/views/external/ngda.net.dns";

                allow-query { any; };
                allow-transfer { 128.111.87.44; campus-ns; d42; };
		notify yes;
		also-notify { 128.111.87.44; };
                notify-source 128.111.87.30;
        };

        zone "ngda.org" in {
                type master;
                file "/var/views/external/ngda.org.dns";

                allow-query { any; };
		allow-transfer { 128.111.87.44; campus-ns; d42; };
		notify yes;
		also-notify { 128.111.87.44; };
                notify-source 128.111.87.30;
        };

        zone "87.111.128.in-addr.arpa" in {
                type master;
                file "/var/views/external/87.111.128.in-addr.arpa.dns";

		allow-query { any; };
		allow-transfer { 128.111.87.44; campus-ns; d42; };
		notify yes;
		also-notify { 128.111.87.44; };
                notify-source 128.111.87.30;
        };

        zone "95.111.128.in-addr.arpa" in {
                type master;
                file "/var/views/external/95.111.128.in-addr.arpa.dns";

		allow-query { any; };
		allow-transfer { 128.111.87.44; campus-ns; d42; };
		notify yes;
		also-notify { 128.111.87.44; };
                notify-source 128.111.87.30;
        };

        zone "96.111.128.in-addr.arpa" in {
                type master;
                file "/var/views/external/96.111.128.in-addr.arpa.dns";

		allow-query { any; };
		allow-transfer { 128.111.87.44; campus-ns; d42; };
		notify yes;
		also-notify { 128.111.87.44; };
                notify-source 128.111.87.30;
        };

        zone "97.111.128.in-addr.arpa" in {
                type master;
                file "/var/views/external/97.111.128.in-addr.arpa.dns";

		allow-query { any; };
		allow-transfer { 128.111.87.44; campus-ns; d42; };
		notify yes;
		also-notify { 128.111.87.44; };
                notify-source 128.111.87.30;
        };

};

view "external-chaos" chaos {
	match-clients { any; };
	recursion no;

	zone "bind" {
		type master;
		file "/var/views/external/db.bind";
		
		allow-query { any; };
		allow-transfer { none; };
	};
};

		
